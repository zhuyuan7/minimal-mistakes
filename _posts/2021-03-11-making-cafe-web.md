---
title:  "(3) 서울 카페 추천 웹사이트 만들기 - 구글맵 카페 댓글 크롤링"
excerpt: "구글맵 이용 카페 댓글 크롤링"
permalink: "/blog/making-cafe-web-03/"
author_profile: true
toc: true
toc_sticky: true
# toc_label: "페이지 주요 목차"  --toc의 기본값은 "on this page"

categories:
  - 카페 추천
  - 크롤링
tags:
  - 카페 
  - 맞춤
  - 추천
  - 웹사이트
  - 구글맵
  - 크롤링
  - 정보
#{{ page.last_modified_at | date: '%Y:%B:%A:%d:%S:%R' }}
---
<br>

**2020-10-21**부터 **2020-12-28**까지 진행했던 **[서울시 25개구 카페추천 웹페이지 만들기](https://zhuyuan7.github.io/project/)** 팀프로젝트 개발에 대한 포스팅이다.

이 글에서는 구글맵 상의 카페 이용후기 데이터 크롤링 과정 을 소개한다.
<br>

-----

<br>
## 1. 카페 이용 후기 수집대상 포털사이트 선정

카카오맵에서 확보한 12,000건에 대한 카페정보 데이터를 활용해 
구글맵에서 카페 이용 후기들을 수집하였다.

### 1.1. 왜 굳이 카카오맵이 아닌 구글맵에서 이용후기를 수집했는가?
카카오맵에서 카페정보를 수집하고 수집된 카페들의 후기를 수집해보았는 데,
후기 데이터의 양도 적을 뿐더러, 댓글의 내용이 너무 짧고 구체적이지 않아 
카페 특색을 추출하기엔 부적합하다고 판단하였다. 
또한 네이버 지도는 데이터의 양은 많지만, 카카오맵과 같은 이유로 제외시켰다.

반면에 구글맵은 데이터의 양도 많고, 댓글의 내용도 구체적이라
댓글을 통해 카페 특색을 보다 정확하게 추출할 수 있어서 구글맵에서 
카페 후기 정보를 수집하기로 최종 결정하였다.

<br>

![카페후기](https://zhuyuan7.github.io/assets/images/카페후기.jpg "카페후기"){: .align-center}
<center> <그림 1> 구글맵, 카카오맵, 네이버 지도 이용 후기 </center>

<br>
### 1. 2. 구글맵 API 사용제한

앞서 살펴본 [Kakao REST API](https://developers.kakao.com/tool/rest-api/open/get/v2-local-search-keyword.%7Bformat%7D) 사용시 사용제한이 있는 것과 같이, 
[Google Maps Platform](https://developers.google.com/maps/faq#usage_apis) 에서도 
API 사용 제한이 있어 보다 원활한 정보 수집을 위해 직접 코드를 작성하여 웹크롤링을 진행하였다.


![구글제한](https://zhuyuan7.github.io/assets/images/구글제한.jpg "구글제한"){: .align-center}
<center> <그림 2> 구글맵 API 사용제한 </center>


----

<br>
## 2. 구글맵 상의 카페 이용 후기 수집
### 2.1. 서울시 25개 구 카페 이요 후기 데이터 수집

카카오맵 웹크롤링을 통해 확보한 12,500개의 25개 구 카페 정보 데이터을 기반으로, 
구글맵 상의 카페 이용 후기를 수집하였다.

카카오맵과 구글맵 상의 등록된 카페정보의 불일치를 방지하기 위해, 
"카페이름"+"카페주소"+카페전화번호"로 설정하여 수집을 진행하였다.
작성한 코드는 다음과 같다.

```python
    # 카페 1개의 정보 구, ID, 카페명, 주소 ...
    # df = pd.read_csv(r'C:\Users\USER\Desktop\cafe_list\result_gu.csv')
    # df['검색어'] = df['카페명'] + df['주소'] + df['전화번호']
    df = pd.read_csv(r'C:\Users\USER\Desktop\cafe_list\CAFE\XIN_result_gu2.csv', encoding='utf-8-sig', sep="|")
    gu = df['구']
    cafe_id = df['ID']
    cafe_name = df['카페명']
    cafe_addr = df['주소']
    cafe_tel = df['전화번호'].astype(str)
    cafe_len = len(cafe_name)
    search_name = []
    for i in range(cafe_len):
        name = cafe_name[i] + " " + cafe_addr[i] + " " + cafe_tel[i]
        search_name.append({
            "name":name,
            "gu": gu[i],
            "cafe_id": cafe_id[i]
        })

```
<br>


### 2.2. 수집과정 중 오류발생

카페 이용 후기 데이터의 정확도를 높이기 위해, 검색어를 `df['검색어'] = df['카페명'] + df['주소'] + df['전화번호']` 설정했는 데,
카카오맵과 구글맵의 각 등록된 카페정보가 불일치하여, 
복수 결과값(한국어표기-영문표기)과 부분 일치값(도로명 주소-지번 주소)을 도출하게 되었다.
이러한 불일치 정보는 이용 후기 데이터에서 제외시켰다.

![후기오류](https://zhuyuan7.github.io/assets/images/후기오류.jpg "후기오류"){: .align-center}
<center> <그림 3> 구글맵 후기오류 </center>





<br>
>**Beautiful Soup이란?**  
 **Beautiful Soup**은 HTML 및 XML 파일에서 데이터를 가져 오기위한 Python 라이브러리입니다. 
 자주 사용하는 파서와 함께 작동하여 구문 분석 트리를 탐색, 검색 및 수정하는 관용적 인 방법을 제공합니다. 일반적으로 프로그래머의 
 작업 시간 또는 며칠을 절약합니다.
 * 출처:[Beautiful Soup 4.9.0 documentation](https://www.crummy.com/software/BeautifulSoup/bs4/doc/)





<br>
### 2.1 서울 특별시 구 리스트 

먼저  크롤링할 25개 구 카페의 검색어를  **"구 이름"+"카페"**<sup>(강남구카페)</sup> 으로 설정하였고, 
for문을 사용하여 각 구의 카페 정보를 수집하기 위해서, 서울시 25개 구(gu_name）를 
리스트(gu_list) 형태로 만들었다.

```python
gu_list = ['마포구','서대문구','은평구','종로구','중구','용산구','성동구','광진구',
           '동대문구','성북구','강북구','도봉구','노원구','중랑구','강동구','송파구',
           '강남구','서초구','관악구','동작구','영등포구','금천구','구로구','양천구',
           '강서구']

```


<br>
### 2.2 서울시 25개 구 카페정보 데이터 수집
코드를 작성해 확보한 서울시 25개 구 카페의 **"카페명"+"주소"+"영업시간"+"전화번호"+"대표사진주소"** 에 대한
총 12,500개의 데이터를 확보했다.  <표2>를 보면 알 수 있듯이, 각 구(gu_name)마다 500개의 데이터를 확보하였지만,
전처리 과정에서 도봉구(424개) 데이터 파일 안에 "주소"가 "노원구"인 76개 데이터의 존재를 발견하여
해당 데이터들은 "노원구" 파일 안에 옮겨놓았다.

<center> <표 2> 서울시 25개 구 카페정보 데이터 개수 </center>

| 구(식별자) 	| 데이터 수 	|  구(식별자)  	| 데이터 수 	|   구(식별자)   	| 데이터 수 	|
|:----------:	|:---------:	|:------------:	|:---------:	|:--------------:	|:---------:	|
| 강남구(GN) 	|    500    	|  도봉구(DB)  	|  **424**  	|   양천구(YC)   	|    500    	|
| 강동구(GD) 	|    500    	| 동대문구(DD) 	|    500    	|  영등포구(YD)  	|    500    	|
| 강북구(GB) 	|    500    	|  동작구(DJ)  	|    500    	|   용산구(YS)   	|    500    	|
| 강서구(GS) 	|    500    	|  마포구(MP)  	|    500    	|   은평구(EP)   	|    500    	|
| 관악구(GA) 	|    500    	| 서대문구(SD) 	|    500    	|   종로구(JR)   	|    500    	|
| 광진구(GJ) 	|    500    	|  서초구(SC)  	|    500    	|    중구(JG)    	|    500    	|
| 구로구(GR) 	|    500    	|  성동구(SD)  	|    500    	|   중랑구(JL)   	|    500    	|
| 금천구(GC) 	|    500    	|  성북구(SB)  	|    500    	|                	|           	|
| 노원구(NW) 	|  **576**  	|  송파구(SP)  	|    500    	| 총 데이터 합계 	|   12500   	|

이리하여 "카페 추천 웹페이지"프로젝트에 사용할 카페정보 데이터 총 12,500개의 데이터를 확보하였다. 



<br>
### 2.3 고유 식별자 부여

확보한 "25개 구 카페 정보 데이터"들이 다음 단계인 각 카페에 대한 댓글 데이터 수집 과정에서
이 댓글이 어느 카페의 댓글인지 구별할 수 있도록 미리 각 카페에 대해 "구(이니셜)"와 "ID(수집된 순서)"를 부여하여 
고유 식별자를 설정하였다.  
```예) 카페노티드 청담 : GN(강남구)+ID(1번째 순서) --> GN1 : 카페노티드 청담```
<br>

![카페정보데이터](https://zhuyuan7.github.io/assets/images/카페정보데이터.jpg "카페정보데이터"){: .align-center}<center> <그림 4> 서울시 25개 구 카페정보 수집 결과물 </center>

